---
title: "Preparação de dados - Ação 6.1"
output: html_notebook
---

```{r}
library(tidyverse)
```

```{r}
# options
options(timeout = 1e6)
sf::sf_use_s2(FALSE)
```

#### Importar dados
```{r}
download.file(url = "https://esajournals.onlinelibrary.wiley.com/action/downloadSupplement?doi=10.1002%2Fecy.1998&file=ecy1998-sup-0001-DataS1.zip",
              destfile = "data/data_papers/atlantic_camtrap.zip",
              mode = "wb"
              )

unzip(
    zipfile = "data/data_papers/atlantic_camtrap.zip",
    exdir = "data/data_papers"
    )
```

```{r}
download.file(url = "https://esajournals.onlinelibrary.wiley.com/action/downloadSupplement?doi=10.1002%2Fecy.2785&file=ecy2785-sup-0001-DataS1.zip",
              destfile = "data/data_papers/atlantic_large_mammals.zip",
              mode = "wb"
              )

unzip(
    zipfile = "data/data_papers/atlantic_large_mammals.zip",
    exdir = "data/data_papers"
    )
```

```{r}
download.file(url = "https://esajournals.onlinelibrary.wiley.com/action/downloadSupplement?doi=10.1002%2Fecy.3128&file=ecy3128-sup-0001-DataS1.zip",
              destfile = "data/data_papers/neotropical_carnivores.zip",
              mode = "wb"
              )

unzip(
    zipfile = "data/data_papers/neotropical_carnivores.zip",
    exdir = "data/data_papers"
    )
```

## Atlantic-Camtraps

### Importar os sites
```{r}
# import sites
ca_si <- readr::read_csv("data/data_papers/ATLANTIC_CAMTRAPS_1-0_LOCATION.csv") %>% 
    dplyr::select(location_id, X, Y)
ca_si
```

### Importar as amostragens
```{r}
# import sites names
ca_si_na <- readr::read_csv("data/data_papers/ATLANTIC_CAMTRAPS_1-0_SURVEY.csv") %>% 
    dplyr::left_join(., ca_si, by = "location_id") %>% 
    dplyr::select(location_id, survey_id, yearfinish,  X, Y)
ca_si_na
```

### Importar os nomes das espécies
```{r}
# import species names
ca_sp_na <- readr::read_csv("data/data_papers/ATLANTIC_CAMTRAPS_1-0_SPECIES.csv") %>% 
    dplyr::select(order:genus, species_name, species_code)
ca_sp_na

```

### Importar registros
```{r}
# import species
ca_sp <- readr::read_csv("data/data_papers/ATLANTIC_CAMTRAPS_1-0_RECORDS.csv") %>% 
    dplyr::select(survey_id, species_code, presence_absence) %>% 
    dplyr::filter(presence_absence == 1) %>% 
    dplyr::mutate(species_code = ifelse(species_code == "Potu_flav", "Poto_flav", species_code)) %>% 
    dplyr::left_join(., ca_sp_na, by = "species_code") %>% 
    dplyr::select(-c(presence_absence,  species_code))
ca_sp
```

### Integrar informações
```{r}
# join data
ca_occ <- ca_sp %>% 
    dplyr::left_join(ca_si_na, by = "survey_id") %>% 
    dplyr::mutate(species = species_name,
                  longitude = as.numeric(X), 
                  latitude = as.numeric(Y), 
                  year = as.numeric(yearfinish),
                  source = "atlantic_camtrap") %>%
    dplyr::select(order:genus, species, longitude, latitude, year, source) %>% 
    tibble::rowid_to_column()
ca_occ
```

### Exportar
```{r}
# export data
readr::write_csv(ca_occ, "data/atlantic_camtrap.csv")
```

## Atlantic Large Mammals

### Importar dados
```{r}
# import data
lm_occ <- readr::read_csv("data/data_papers/ATLANTIC_MAMMAL_MID_LARGE _assemblages_and_sites.csv") %>% 
    dplyr::mutate(genus = str_split(Actual_species_Name, " ", simplify = TRUE)[, 1],
                  species = Actual_species_Name,
                  longitude = as.numeric(Longitude), 
                  latitude = as.numeric(Latitude), 
                  year = as.numeric(Year_finish),
                  source = "atlantic_large_mammals") %>%
    dplyr::select(genus, species, longitude, latitude, year, source) %>% 
    tidyr::drop_na(longitude, latitude) %>% 
    dplyr::mutate(species = str_trim(species)) %>% 
    tibble::rowid_to_column() %>% 
    dplyr::left_join(., rbind(unique(ca_occ[, c(2, 3, 4)])), by = "genus") %>% 
    dplyr::relocate(order:family, .before = 2)
lm_occ
```

### Exportar
```{r}
# export data
readr::write_csv(lm_occ, "data/atlantic_large_mammals.csv")
```

## Neotropical Carnivores

### Importar dados
```{r}
# import
neo_car_occ <- readr::read_csv("data/data_papers/NEOTROPICAL_CARNIVORES_DATASET_2020-04.csv")
```

### Filtrar registros duvidosos
```{r}
neo_car_occ <- neo_car_occ[!grepl("Informal interview", neo_car_occ$TYPE_REC),]
neo_car_occ <- neo_car_occ[!grepl("Interview", neo_car_occ$TYPE_REC),]
neo_car_occ <- neo_car_occ[!grepl("Scratch", neo_car_occ$TYPE_REC),]
neo_car_occ <- neo_car_occ[!grepl("Sign", neo_car_occ$TYPE_REC),]
neo_car_occ <- neo_car_occ[!grepl("Scat", neo_car_occ$TYPE_REC),]
neo_car_occ <- neo_car_occ[!grepl("Vocalization", neo_car_occ$TYPE_REC),]
neo_car_occ <- neo_car_occ[!grepl("Track", neo_car_occ$TYPE_REC),]
neo_car_occ <- neo_car_occ[!grepl("Sighting", neo_car_occ$TYPE_REC),]
neo_car_occ <- neo_car_occ[!grepl("Literature review", neo_car_occ$TYPE_REC),]

sort(unique(neo_car_occ$TYPE_REC))

neo_car_occ <- neo_car_occ %>%
    dplyr::mutate(family = FAMILY,
                  genus = GENUS,
                  species = SPECIES,
                  name = SPECIES, 
                  longitude = LONG_X, 
                  latitude = LAT_Y,
                  year = as.numeric(COL_END_YR),
                  source = "neotropical_carnivores") %>%
    dplyr::select(family, genus, species, longitude, latitude, year, source) %>% 
    dplyr::mutate(species = str_trim(species)) %>% 
    tibble::rowid_to_column() %>% 
    dplyr::left_join(., unique(rbind(ca_occ[, c(2, 4)], lm_occ[, c(2, 4)])), by = "genus") %>% 
    dplyr::relocate(order, .after = 1)
neo_car_occ
```

### Exportar
```{r}
# export data
readr::write_csv(neo_car_occ, "data/neotropical_carnivores.csv")

```
